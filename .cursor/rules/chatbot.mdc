---
alwaysApply: true
---

# Reglas del Chatbot - MGM Abogados

## ğŸ¤– Sistema Unificado

### Event Listeners
- Usar SOLO el sistema unificado en `BaseLayout.astro`
- NO crear sistemas duplicados de event listeners
- NO modificar el script existente sin coordinaciÃ³n

### Botones de Chat
```html
<!-- âœ… Correcto -->
<button 
  type="button"
  data-chat-open
  class="btn-primary"
  aria-label="Abrir chat para consulta legal"
>
  Consultar por Chat
</button>

<!-- âŒ Incorrecto -->
<button onclick="openChat()">Chat</button>
<button id="chat-btn">Chat</button>
```

## ğŸ”§ ImplementaciÃ³n

### BaseLayout.astro
```html
<script is:inline>
  // Sistema unificado de chatbot
  // NO MODIFICAR sin coordinaciÃ³n
  document.addEventListener('click', (event) => {
    const chatButton = event.target.closest('[data-chat-open]');
    if (chatButton) {
      event.preventDefault();
      window.n8nChatOpen();
    }
  });
</script>
```

### ChatbotWidget.tsx
```tsx
// Componente para cargar el chatbot n8n
// NO MODIFICAR la lÃ³gica de carga
export default function ChatbotWidget() {
  useEffect(() => {
    // Cargar CSS y JS del chatbot
  }, []);
  
  return <div id="n8n-chat" />;
}
```

## ğŸ“ UbicaciÃ³n de Botones

### PÃ¡ginas de Servicio
- Hero section: BotÃ³n principal de chat
- Sidebar: BotÃ³n secundario
- Footer: BotÃ³n de contacto

### PÃ¡gina Principal
- Hero section: "Consultar por Chat"
- SecciÃ³n de contacto: BotÃ³n de chat

## ğŸ¨ Estilos

### Clases CSS
```css
/* BotÃ³n principal de chat */
.btn-chat-primary {
  @apply bg-accent-600 text-primary-600 px-8 py-4 rounded-lg font-semibold hover:bg-accent-700 transition-colors;
}

/* BotÃ³n secundario de chat */
.btn-chat-secondary {
  @apply border-2 border-primary-600 text-primary-600 px-6 py-3 rounded-md font-medium hover:bg-primary-600 hover:text-white transition-colors;
}
```

### Variables CSS
```css
:root {
  --chat-toggle-background: #0E4A69;
  --chat-toggle-hover: #0c3d57;
  --chat-toggle-active: #08293a;
  --chat-window-width: 380px;
  --chat-window-height: 560px;
}
```

## ğŸ” ValidaciÃ³n

### Checklist
- [ ] BotÃ³n tiene `data-chat-open`
- [ ] BotÃ³n tiene `aria-label`
- [ ] No hay event listeners duplicados
- [ ] Estilos consistentes
- [ ] Funciona en todas las pÃ¡ginas

### Testing
```bash
# Verificar que el chatbot funciona
npm run check:chatbot
```

## ğŸš« Prohibiciones

### NO Hacer
- âŒ Crear event listeners duplicados
- âŒ Modificar el script unificado sin coordinaciÃ³n
- âŒ Usar `onclick` en lugar de `data-chat-open`
- âŒ Crear sistemas alternativos de chat

### NO Modificar
- âŒ `BaseLayout.astro` script de chatbot
- âŒ `ChatbotWidget.tsx` lÃ³gica de carga
- âŒ Variables CSS del chatbot
- âŒ ConfiguraciÃ³n de n8n

## ğŸ¯ Objetivos

### Consistencia
- Mismo comportamiento en todas las pÃ¡ginas
- Estilos uniformes
- Funcionalidad predecible

### Accesibilidad
- Botones con aria-labels
- NavegaciÃ³n por teclado
- Indicadores de estado

### Performance
- Carga asÃ­ncrona del chatbot
- No bloquear el hilo principal
- OptimizaciÃ³n de recursos